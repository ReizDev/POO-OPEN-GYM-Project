<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Admin - Empleados</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Listado de empleados</h2>
    <button class="btn btn-outline-danger">Cerrar sesión</button>
  </div>

  <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#modalEmpleado" onclick="abrirModal()">➕ Agregar nuevo empleado</button>
  
  <table class="table table-striped table-bordered" id="tablaEmpleados">
    <thead class="table-dark">
      <tr>
        <th>ID</th><th>Nombre</th><th>Email</th><th>Teléfono</th><th>Puesto</th><th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <!-- Filas dinámicas -->
    </tbody>
  </table>
</div>

<!-- Modal -->
<div class="modal fade" id="modalEmpleado" tabindex="-1">
  <div class="modal-dialog">
    <form class="modal-content" onsubmit="guardarEmpleado(event)">
      <div class="modal-header"><h5 class="modal-title" id="modalTitulo">Nuevo Empleado</h5></div>
      <div class="modal-body">
        <input type="hidden" id="empleadoId">
        <input type="text" id="nombre" class="form-control mb-2" placeholder="Nombre completo" required>
        <input type="email" id="email" class="form-control mb-2" placeholder="Correo electrónico" required>
        <input type="text" id="telefono" class="form-control mb-2" placeholder="Teléfono" required>
        <input type="text" id="puesto" class="form-control mb-2" placeholder="Puesto" required>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success">Guardar</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
      </div>
    </form>
  </div>
</div>

<script>
let empleados = [];

// Generar ID aleatorio de 5 dígitos
function generarId() {
  return Math.floor(10000 + Math.random() * 90000);
}

// Cargar datos desde localStorage al iniciar
window.onload = () => {
  const datosGuardados = localStorage.getItem("empleados");
  if (datosGuardados) {
    empleados = JSON.parse(datosGuardados);
    renderTabla();
  }
};

function guardarEnLocalStorage() {
  localStorage.setItem("empleados", JSON.stringify(empleados));
}

function renderTabla() {
  const tbody = document.querySelector("#tablaEmpleados tbody");
  tbody.innerHTML = "";
  empleados.forEach(emp => {
    const fila = `
      <tr>
        <td>${emp.id}</td>
        <td>${emp.nombre}</td>
        <td>${emp.email}</td>
        <td>${emp.telefono}</td>
        <td>${emp.puesto}</td>
        <td>
          <button class="btn btn-warning btn-sm" onclick="editarEmpleado(${emp.id})">Editar</button>
          <button class="btn btn-danger btn-sm" onclick="eliminarEmpleado(${emp.id})">Eliminar</button>
        </td>
      </tr>`;
    tbody.innerHTML += fila;
  });
}

function abrirModal() {
  document.getElementById("modalTitulo").textContent = "Nuevo Empleado";
  document.getElementById("empleadoId").value = "";
  document.getElementById("nombre").value = "";
  document.getElementById("email").value = "";
  document.getElementById("telefono").value = "";
  document.getElementById("puesto").value = "";
}

function guardarEmpleado(event) {
  event.preventDefault();
  const id = document.getElementById("empleadoId").value;
  const nombre = document.getElementById("nombre").value;
  const email = document.getElementById("email").value;
  const telefono = document.getElementById("telefono").value;
  const puesto = document.getElementById("puesto").value;

  if (id) {
    // Update
    const emp = empleados.find(e => e.id == id);
    emp.nombre = nombre;
    emp.email = email;
    emp.telefono = telefono;
    emp.puesto = puesto;
  } else {
    // Create con ID aleatorio
    empleados.push({ id: generarId(), nombre, email, telefono, puesto });
  }

  guardarEnLocalStorage();
  renderTabla();
  bootstrap.Modal.getInstance(document.getElementById("modalEmpleado")).hide();
}

function editarEmpleado(id) {
  const emp = empleados.find(e => e.id == id);
  document.getElementById("modalTitulo").textContent = "Editar Empleado";
  document.getElementById("empleadoId").value = emp.id;
  document.getElementById("nombre").value = emp.nombre;
  document.getElementById("email").value = emp.email;
  document.getElementById("telefono").value = emp.telefono;
  document.getElementById("puesto").value = emp.puesto;
  new bootstrap.Modal(document.getElementById("modalEmpleado")).show();
}

function eliminarEmpleado(id) {
  if (confirm("¿Seguro que deseas eliminar este empleado?")) {
    empleados = empleados.filter(e => e.id != id);
    guardarEnLocalStorage();
    renderTabla();
  }
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
